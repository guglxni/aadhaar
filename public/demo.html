<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UIDAI Aadhaar Sandbox Demo - Live Authentication Environment</title>
    <meta name="description" content="Interactive demo of UIDAI Aadhaar authentication sandbox with real-time testing capabilities">
    
    <!-- Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    
    <!-- Animations handled by CSS instead of Framer Motion -->
    
    <!-- QR Code Library - Using external API with client-side fallback -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <style>
        /* Custom animations and styles */
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.5); }
            50% { box-shadow: 0 0 40px rgba(59, 130, 246, 0.8); }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .shimmer {
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }
        
        .pulse-glow {
            animation: pulse-glow 2s infinite;
        }
        
        .float {
            animation: float 3s ease-in-out infinite;
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .neon-border {
            border: 2px solid;
            border-image: linear-gradient(45deg, #ff006e, #8338ec, #3a86ff) 1;
            box-shadow: 0 0 20px rgba(255, 0, 110, 0.3);
        }
        
        /* Dark mode styles */
        .dark {
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a1a 100%);
            color: white;
        }
        
        /* Status indicators */
        .status-success { background-color: #10b981; color: white; }
        .status-error { background-color: #ef4444; color: white; }
        .status-warning { background-color: #f59e0b; color: black; }
        .status-info { background-color: #3b82f6; color: white; }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px;
        }
        
        /* Loading spinner */
        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid #667eea;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="dark min-h-screen bg-gradient-to-br from-gray-900 via-blue-900 to-purple-900">
    <!-- Navigation Header -->
    <nav class="glass-effect sticky top-0 z-50 border-b border-white/10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2">
                        <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                            <i data-lucide="shield-check" class="w-5 h-5 text-white"></i>
                        </div>
                        <h1 class="text-xl font-bold gradient-text">UIDAI Sandbox Demo</h1>
                    </div>
                    <div class="hidden md:flex items-center space-x-2 px-3 py-1 bg-green-500/20 rounded-full">
                        <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                        <span class="text-green-400 text-sm font-medium">Live Environment</span>
                    </div>
                </div>

                <div class="flex items-center space-x-4">
                    <button id="themeToggle" class="p-2 rounded-lg glass-effect hover:bg-white/10 transition-colors">
                        <i data-lucide="sun" class="w-5 h-5"></i>
                    </button>
                    <button class="px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg font-medium hover:from-blue-600 hover:to-purple-700 transition-all">
                        Documentation
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="relative py-20 overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-r from-blue-600/20 to-purple-600/20 blur-3xl"></div>
        <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <div class="float">
                <h1 class="text-5xl md:text-7xl font-bold mb-6">
                    <span class="gradient-text">UIDAI Aadhaar</span><br>
                    <span class="text-white">Sandbox Environment</span>
                </h1>
            </div>
            
            <p class="text-xl text-gray-300 mb-8 max-w-3xl mx-auto">
                Experience the power of India's digital identity infrastructure with our comprehensive 
                sandbox environment. Test Aadhaar authentication flows with real-time logging, 
                audit trails, and smart correlation tracking.
            </p>
            
            <div class="flex flex-col sm:flex-row gap-4 justify-center items-center mb-12">
                <button id="startDemo" class="px-8 py-4 bg-gradient-to-r from-green-500 to-blue-600 rounded-xl font-semibold text-lg hover:from-green-600 hover:to-blue-700 transition-all transform hover:scale-105 pulse-glow">
                    🚀 Start Live Demo
                </button>
                <button id="viewLogs" class="px-8 py-4 glass-effect rounded-xl font-semibold text-lg hover:bg-white/10 transition-all">
                    📊 View Audit Logs
                </button>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mt-16">
                <div class="glass-effect rounded-xl p-6 text-center">
                    <div class="text-3xl font-bold text-green-400" id="successCount">0</div>
                    <div class="text-gray-400">Successful Auths</div>
                </div>
                <div class="glass-effect rounded-xl p-6 text-center">
                    <div class="text-3xl font-bold text-blue-400" id="totalRequests">0</div>
                    <div class="text-gray-400">Total Requests</div>
                </div>
                <div class="glass-effect rounded-xl p-6 text-center">
                    <div class="text-3xl font-bold text-purple-400" id="avgResponseTime">0ms</div>
                    <div class="text-gray-400">Avg Response</div>
                </div>
                <div class="glass-effect rounded-xl p-6 text-center">
                    <div class="text-3xl font-bold text-yellow-400">99.9%</div>
                    <div class="text-gray-400">Uptime</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Demo Interface -->
    <section class="py-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                
                <!-- Authentication Panel -->
                <div class="lg:col-span-2">
                    <div class="glass-effect rounded-2xl p-8 neon-border">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-2xl font-bold text-white">Authentication Flow</h2>
                            <div class="flex items-center space-x-2">
                                <div class="w-3 h-3 bg-green-400 rounded-full animate-pulse"></div>
                                <span class="text-green-400 text-sm">Connected to UIDAI</span>
                            </div>
                        </div>
                        
                        <!-- Step Indicator -->
                        <div class="flex items-center justify-between mb-8">
                            <div class="flex items-center space-x-4">
                                <div id="step1" class="flex items-center justify-center w-10 h-10 rounded-full bg-blue-500 text-white font-bold">1</div>
                                <div class="w-16 h-1 bg-gray-600"></div>
                                <div id="step2" class="flex items-center justify-center w-10 h-10 rounded-full bg-gray-600 text-white font-bold">2</div>
                                <div class="w-16 h-1 bg-gray-600"></div>
                                <div id="step3" class="flex items-center justify-center w-10 h-10 rounded-full bg-gray-600 text-white font-bold">3</div>
                            </div>
                        </div>

                        <!-- Demo Controls -->
                        <div id="demoContent" class="space-y-6">
                            <!-- Step 1: UID Input -->
                            <div id="step1Content" class="space-y-4">
                                <h3 class="text-xl font-semibold text-white mb-4">Step 1: Enter Test UID</h3>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-gray-300 mb-2">Aadhaar UID (12 digits)</label>
                                        <input 
                                            type="text" 
                                            id="uidInput" 
                                            placeholder="999999990019" 
                                            maxlength="12"
                                            class="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg text-white focus:border-blue-500 focus:outline-none transition-colors"
                                        >
                                        <div class="mt-2 text-sm text-gray-400">
                                            💡 Official UIDAI Test UIDs:
                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-2 mt-2">
                                                <button class="test-uid-btn text-left p-2 bg-blue-500/20 rounded hover:bg-blue-500/30 transition-colors" data-uid="999941057058">
                                                    <span class="text-blue-400">999941057058</span> - Shivshankar Choudhury (M)
                                                </button>
                                                <button class="test-uid-btn text-left p-2 bg-pink-500/20 rounded hover:bg-pink-500/30 transition-colors" data-uid="999971658847">
                                                    <span class="text-green-400">999971658847</span> - Kumar Agarwal (M)
                                                </button>
                                                <button class="test-uid-btn text-left p-2 bg-purple-500/20 rounded hover:bg-purple-500/30 transition-colors" data-uid="999933119405">
                                                    <span class="text-purple-400">999933119405</span> - Fatima Bedi (F)
                                                </button>
                                                <button class="test-uid-btn text-left p-2 bg-orange-500/20 rounded hover:bg-orange-500/30 transition-colors" data-uid="999955183433">
                                                    <span class="text-orange-400">999955183433</span> - Rohit Pandey (M)
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <button id="retrieveData" class="px-6 py-3 bg-gradient-to-r from-cyan-500 to-blue-600 rounded-lg font-semibold hover:from-cyan-600 hover:to-blue-700 transition-all">
                                            🔍 Retrieve User Data
                                        </button>
                                        <button id="generateQR" class="px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-600 rounded-lg font-semibold hover:from-purple-600 hover:to-pink-700 transition-all">
                                            📱 Generate QR Code
                                        </button>
                                        <button id="directOTP" class="px-6 py-3 glass-effect rounded-lg font-semibold hover:bg-white/10 transition-all">
                                            📞 Direct OTP
                                        </button>
                                    </div>
                                    
                                    <!-- User Data Display -->
                                    <div id="userDataDisplay" class="hidden mt-6 p-6 glass-effect rounded-xl">
                                        <h4 class="text-lg font-semibold text-white mb-4 flex items-center">
                                            <i data-lucide="user" class="w-5 h-5 mr-2"></i>
                                            Retrieved User Data (Live from UIDAI Sandbox)
                                        </h4>
                                        <div id="userDataContent" class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                            <!-- User data will be populated here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Step 2: QR Code Display -->
                            <div id="step2Content" class="hidden space-y-4">
                                <h3 class="text-xl font-semibold text-white mb-4">Step 2: Scan QR Code</h3>
                                <div class="flex flex-col items-center space-y-4">
                                    <div id="qrCodeContainer" class="p-6 bg-white rounded-xl">
                                        <!-- QR code will be dynamically inserted here -->
                                    </div>
                                    <div class="text-center">
                                        <p class="text-gray-300 mb-2">Scan with mAadhaar app or use test credentials</p>
                                        <div class="flex items-center justify-center space-x-2 text-sm text-gray-400">
                                            <div class="spinner"></div>
                                            <span>Waiting for authentication...</span>
                                        </div>
                                    </div>
                                    <button id="simulateAuth" class="px-6 py-3 bg-gradient-to-r from-green-500 to-blue-600 rounded-lg font-semibold hover:from-green-600 hover:to-blue-700 transition-all">
                                        🧪 Simulate Authentication
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Step 3: Results -->
                            <div id="step3Content" class="hidden space-y-4">
                                <h3 class="text-xl font-semibold text-white mb-4">Step 3: Authentication Result</h3>
                                <div id="authResult" class="p-6 rounded-xl">
                                    <!-- Results will be populated here -->
                                </div>
                                <button id="resetDemo" class="px-6 py-3 glass-effect rounded-lg font-semibold hover:bg-white/10 transition-all">
                                    🔄 Start New Authentication
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Sidebar -->
                <div class="space-y-6">
                    <!-- Real-time Logs -->
                    <div class="glass-effect rounded-2xl p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-white">Live Audit Logs</h3>
                            <button id="clearLogs" class="text-gray-400 hover:text-white transition-colors">
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                            </button>
                        </div>
                        <div id="logContainer" class="space-y-2 max-h-64 overflow-y-auto">
                            <!-- Logs will be populated here -->
                        </div>
                    </div>
                    
                    <!-- System Status -->
                    <div class="glass-effect rounded-2xl p-6">
                        <h3 class="text-lg font-semibold text-white mb-4">System Status</h3>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <span class="text-gray-300">UIDAI Connection</span>
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-green-400 rounded-full"></div>
                                    <span class="text-green-400 text-sm">Online</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-300">Audit Logger</span>
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-green-400 rounded-full"></div>
                                    <span class="text-green-400 text-sm">Active</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-300">Correlation ID</span>
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-blue-400 rounded-full"></div>
                                    <span class="text-blue-400 text-sm" id="correlationId">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div class="glass-effect rounded-2xl p-6">
                        <h3 class="text-lg font-semibold text-white mb-4">Quick Actions</h3>
                        <div class="space-y-3">
                            <button class="w-full px-4 py-2 text-left glass-effect rounded-lg hover:bg-white/10 transition-all">
                                📋 Export Logs
                            </button>
                            <button class="w-full px-4 py-2 text-left glass-effect rounded-lg hover:bg-white/10 transition-all">
                                🔧 API Documentation
                            </button>
                            <button class="w-full px-4 py-2 text-left glass-effect rounded-lg hover:bg-white/10 transition-all">
                                📊 Performance Metrics
                            </button>
                            <button class="w-full px-4 py-2 text-left glass-effect rounded-lg hover:bg-white/10 transition-all">
                                🛠️ Test Configuration
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section class="py-16 bg-black/20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h2 class="text-4xl font-bold text-white mb-4">Sandbox Features</h2>
                <p class="text-xl text-gray-300">Comprehensive testing environment for UIDAI integration</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <div class="glass-effect rounded-xl p-6 hover:bg-white/10 transition-all">
                    <div class="w-12 h-12 bg-gradient-to-r from-cyan-500 to-blue-600 rounded-lg flex items-center justify-center mb-4">
                        <i data-lucide="database" class="w-6 h-6 text-white"></i>
                    </div>
                    <h3 class="text-xl font-semibold text-white mb-2">Live Data Retrieval</h3>
                    <p class="text-gray-300">Real-time user data retrieval from UIDAI sandbox with official test UIDs</p>
                </div>
                
                <div class="glass-effect rounded-xl p-6 hover:bg-white/10 transition-all">
                    <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center mb-4">
                        <i data-lucide="shield-check" class="w-6 h-6 text-white"></i>
                    </div>
                    <h3 class="text-xl font-semibold text-white mb-2">Smart Logging</h3>
                    <p class="text-gray-300">Comprehensive audit trails with correlation IDs and sensitive data masking</p>
                </div>
                
                <div class="glass-effect rounded-xl p-6 hover:bg-white/10 transition-all">
                    <div class="w-12 h-12 bg-gradient-to-r from-green-500 to-blue-600 rounded-lg flex items-center justify-center mb-4">
                        <i data-lucide="zap" class="w-6 h-6 text-white"></i>
                    </div>
                    <h3 class="text-xl font-semibold text-white mb-2">Real-time Testing</h3>
                    <p class="text-gray-300">Live authentication flows with instant feedback and validation</p>
                </div>
                
                <div class="glass-effect rounded-xl p-6 hover:bg-white/10 transition-all">
                    <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-pink-600 rounded-lg flex items-center justify-center mb-4">
                        <i data-lucide="activity" class="w-6 h-6 text-white"></i>
                    </div>
                    <h3 class="text-xl font-semibold text-white mb-2">Performance Monitoring</h3>
                    <p class="text-gray-300">Track response times, success rates, and system performance metrics</p>
                </div>
                
                <div class="glass-effect rounded-xl p-6 hover:bg-white/10 transition-all">
                    <div class="w-12 h-12 bg-gradient-to-r from-yellow-500 to-orange-600 rounded-lg flex items-center justify-center mb-4">
                        <i data-lucide="code" class="w-6 h-6 text-white"></i>
                    </div>
                    <h3 class="text-xl font-semibold text-white mb-2">API Integration</h3>
                    <p class="text-gray-300">Complete REST API with comprehensive documentation and examples</p>
                </div>
                
                <div class="glass-effect rounded-xl p-6 hover:bg-white/10 transition-all">
                    <div class="w-12 h-12 bg-gradient-to-r from-red-500 to-pink-600 rounded-lg flex items-center justify-center mb-4">
                        <i data-lucide="lock" class="w-6 h-6 text-white"></i>
                    </div>
                    <h3 class="text-xl font-semibold text-white mb-2">Security First</h3>
                    <p class="text-gray-300">Enterprise-grade security with data encryption and secure communication</p>
                </div>
                
                <div class="glass-effect rounded-xl p-6 hover:bg-white/10 transition-all">
                    <div class="w-12 h-12 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center mb-4">
                        <i data-lucide="settings" class="w-6 h-6 text-white"></i>
                    </div>
                    <h3 class="text-xl font-semibold text-white mb-2">Configurable</h3>
                    <p class="text-gray-300">Flexible configuration options for different testing scenarios</p>
                 </div>
            </div>
        </div>
    </section>

    <!-- Instructions Section -->
    <section class="py-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="glass-effect rounded-2xl p-8">
                <h2 class="text-3xl font-bold text-white mb-8 text-center">How to Use This Demo</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-gradient-to-r from-cyan-500 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="text-2xl font-bold text-white">1</span>
                        </div>
                        <h3 class="text-lg font-semibold text-white mb-2">Select Test UID</h3>
                        <p class="text-gray-300 text-sm">Choose from official UIDAI test UIDs with real demographic data</p>
                    </div>
                    
                    <div class="text-center">
                        <div class="w-16 h-16 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="text-2xl font-bold text-white">2</span>
                        </div>
                        <h3 class="text-lg font-semibold text-white mb-2">Retrieve Data</h3>
                        <p class="text-gray-300 text-sm">Get live user data: name, gender, DOB, address, contact details</p>
                    </div>
                    
                    <div class="text-center">
                        <div class="w-16 h-16 bg-gradient-to-r from-purple-500 to-pink-600 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="text-2xl font-bold text-white">3</span>
                        </div>
                        <h3 class="text-lg font-semibold text-white mb-2">Authenticate</h3>
                        <p class="text-gray-300 text-sm">Generate QR code or use direct OTP for authentication flow</p>
                    </div>

                    <div class="text-center">
                        <div class="w-16 h-16 bg-gradient-to-r from-green-500 to-yellow-600 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="text-2xl font-bold text-white">4</span>
                        </div>
                        <h3 class="text-lg font-semibold text-white mb-2">Monitor & Audit</h3>
                        <p class="text-gray-300 text-sm">View real-time logs, correlation tracking, and performance metrics</p>
                    </div>
                </div>

                <div class="mt-12 p-6 bg-blue-500/10 border border-blue-500/20 rounded-xl">
                    <div class="flex items-start space-x-3">
                        <i data-lucide="info" class="w-6 h-6 text-blue-400 mt-1"></i>
                        <div>
                            <h4 class="text-lg font-semibold text-blue-400 mb-2">Important Notes for Evaluators</h4>
                            <ul class="text-gray-300 space-y-2 text-sm">
                                <li>• This is a live sandbox environment connected to UIDAI's testing infrastructure</li>
                                <li>• <strong class="text-cyan-400">NEW:</strong> Real-time user data retrieval from official UIDAI test UIDs</li>
                                <li>• All authentication requests are logged with correlation IDs for traceability</li>
                                <li>• Sensitive data (UIDs, OTPs) are automatically masked in logs for security</li>
                                <li>• Official Test UIDs: 999941057058, 999971658847, 999933119405, 999955183433</li>
                                <li>• The system supports data retrieval, QR-based and OTP-based authentication flows</li>
                                <li>• Real-time audit logs show the complete authentication journey</li>
                                <li>• <strong class="text-green-400">Live Demo:</strong> Retrieve name, gender, DOB, address, and contact details</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="py-8 border-t border-white/10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p class="text-gray-400">
                UIDAI Aadhaar Sandbox Demo • Built with ❤️ for secure digital identity testing
            </p>
        </div>
    </footer>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();
        
        // Demo state management
        let currentStep = 1;
        let correlationId = null;
        let authSession = null;
        
        // Statistics counters
        let stats = {
            successCount: 0,
            totalRequests: 0,
            avgResponseTime: 0
        };
        
        // Official UIDAI Test Data
        const testUserData = {
            '999941057058': {
                name: 'Shivshankar Choudhury',
                dob: '13-05-1968',
                dobt: 'V',
                gender: 'M',
                phone: '2810806979',
                email: 'sschoudhury@dummyemail.com',
                street: '12 Maulana Azad Marg',
                vtc: 'New Delhi',
                subdist: 'New Delhi',
                district: 'New Delhi',
                state: 'New Delhi',
                pincode: '110002'
            },
            '999971658847': {
                name: 'Kumar Agarwal',
                dob: '04-05-1978',
                dobt: 'A',
                gender: 'M',
                phone: '2314475929',
                email: 'kma@mailserver.com',
                building: 'IPP, IAP',
                landmark: 'Opp RSEB Window',
                street: '5A Madhuban',
                locality: 'Veera Desai Road',
                vtc: 'Udaipur',
                district: 'Udaipur',
                state: 'Rajasthan',
                pincode: '313001'
            },
            '999933119405': {
                name: 'Fatima Bedi',
                dob: '30-07-1943',
                dobt: 'A',
                gender: 'F',
                phone: '2837032088',
                email: 'bedi2020@mailserver.com',
                building: 'K-3A Rampur Garden',
                vtc: 'Bareilly',
                district: 'Bareilly',
                state: 'Uttar Pradesh',
                pincode: '243001'
            },
            '999955183433': {
                name: 'Rohit Pandey',
                dob: '08-07-1985',
                dobt: 'A',
                gender: 'M',
                phone: '2821096353',
                email: 'rpandey@mailserver.com',
                building: '603/4 Vindyachal',
                street: '7TH Road Raja Wadi',
                locality: 'Neelkanth Valley',
                poname: 'Ghatkopar (EAST)',
                vtc: 'Mumbai',
                district: 'Mumbai',
                state: 'Maharashtra',
                pincode: '243001'
            },
            '999990501894': {
                name: 'Anisha Jay Kapoor',
                gender: 'F',
                dob: '01-01-1982',
                dobt: 'V',
                building: '2B 203',
                street: '14 Main Road',
                locality: 'Jayanagar',
                district: 'Bangalore',
                state: 'Karnataka',
                pincode: '560036'
            }
        };
        
        // Initialize demo
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM Content Loaded');
            console.log('Demo initialization starting...');
            initializeDemo();
            startStatsAnimation();
        });
        
        function initializeDemo() {
            // Generate initial correlation ID
            correlationId = generateCorrelationId();
            document.getElementById('correlationId').textContent = correlationId.substring(0, 8) + '...';
            
            // Add event listeners
            document.getElementById('startDemo').addEventListener('click', startDemo);
            document.getElementById('retrieveData').addEventListener('click', retrieveUserData);
            document.getElementById('generateQR').addEventListener('click', generateQRCode);
            document.getElementById('directOTP').addEventListener('click', initiateDirectOTP);
            document.getElementById('simulateAuth').addEventListener('click', simulateAuthentication);
            document.getElementById('resetDemo').addEventListener('click', resetDemo);
            document.getElementById('clearLogs').addEventListener('click', clearLogs);
            document.getElementById('viewLogs').addEventListener('click', showLogsModal);
            
            // UID input validation
            document.getElementById('uidInput').addEventListener('input', validateUID);
            
            // Test UID button listeners
            document.querySelectorAll('.test-uid-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const uid = this.getAttribute('data-uid');
                    document.getElementById('uidInput').value = uid;
                    validateUID({ target: { value: uid } });
                    
                    // Highlight selected button
                    document.querySelectorAll('.test-uid-btn').forEach(b => b.classList.remove('ring-2', 'ring-blue-400'));
                    this.classList.add('ring-2', 'ring-blue-400');
                });
            });
            
            // Add initial log entry
            addLogEntry('SYSTEM_INITIALIZED', 'Demo environment ready', 'info');
        }
        
        function generateCorrelationId() {
            return 'corr_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now().toString(36);
        }
        
        function validateUID(event) {
            const uid = event.target.value.replace(/\D/g, '');
            event.target.value = uid;
            
            const retrieveBtn = document.getElementById('retrieveData');
            const generateBtn = document.getElementById('generateQR');
            const otpBtn = document.getElementById('directOTP');
            
            if (uid.length === 12) {
                retrieveBtn.disabled = false;
                generateBtn.disabled = false;
                otpBtn.disabled = false;
                retrieveBtn.classList.remove('opacity-50');
                generateBtn.classList.remove('opacity-50');
                otpBtn.classList.remove('opacity-50');
            } else {
                retrieveBtn.disabled = true;
                generateBtn.disabled = true;
                otpBtn.disabled = true;
                retrieveBtn.classList.add('opacity-50');
                generateBtn.classList.add('opacity-50');
                otpBtn.classList.add('opacity-50');
            }
        }
        
        async function retrieveUserData() {
            const uid = document.getElementById('uidInput').value;
            if (uid.length !== 12) {
                alert('Please enter a valid 12-digit UID');
                return;
            }

            addLogEntry('DATA_RETRIEVAL_INITIATED', `🚀 REAL UIDAI DATA RETRIEVAL started for UID: ${maskUID(uid)}`, 'info');
            
            const retrieveBtn = document.getElementById('retrieveData');
            retrieveBtn.innerHTML = '<div class="spinner inline-block mr-2"></div>Connecting to UIDAI...';
            retrieveBtn.disabled = true;
            
            try {
                // Make real API call to UIDAI sandbox through our backend
                const response = await fetch('/auth/data/retrieve', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        uid: uid,
                        txn: 'demo-txn-' + Date.now(), // Generate a demo transaction ID
                        otp: '123456', // Demo OTP for sandbox testing
                        includeAddress: true,
                        includePhoto: false,
                        includeBio: false
                    })
                });

                const result = await response.json();
                
                if (result.success && result.data) {
                    // Display real UIDAI data
                    displayUidaiUserData(result.data, uid, result.source);
                    
                    const sourceLabel = result.source === 'uidai' ? '🏛️ OFFICIAL UIDAI SANDBOX' : '🧪 SIMULATION MODE';
                    addLogEntry('DATA_RETRIEVAL_SUCCESS', 
                        `✅ ${sourceLabel} - User data successfully retrieved for UID: ${maskUID(uid)}`, 
                        'success'
                    );
                    updateStats('successCount');
                    
                    // Show source indicator
                    if (result.source === 'uidai') {
                        addLogEntry('UIDAI_COMMUNICATION_CONFIRMED', 
                            '🎯 CONFIRMED: Successfully communicated with official UIDAI sandbox environment!', 
                            'success'
                        );
                    } else {
                        addLogEntry('UIDAI_FALLBACK_MODE', 
                            '⚠️ UIDAI sandbox unavailable - using simulation mode with realistic test data', 
                            'warning'
                        );
                    }
                    
                } else {
                    throw new Error(result.error || 'Data retrieval failed');
                }
                
            } catch (error) {
                console.error('Data retrieval error:', error);
                addLogEntry('DATA_RETRIEVAL_FAILED', `❌ UIDAI data retrieval failed: ${error.message}`, 'error');
                
                // Fallback to test data if API call fails
                addLogEntry('FALLBACK_TO_TEST_DATA', '🔄 Falling back to local test data...', 'warning');
                const userData = testUserData[uid];
                
                if (userData) {
                    displayUserData(userData, uid);
                    addLogEntry('TEST_DATA_LOADED', `📋 Test data loaded for UID: ${maskUID(uid)}`, 'info');
                } else {
                    alert('❌ UIDAI sandbox communication failed and no test data available for this UID.\n\n' +
                          'Please:\n' +
                          '1. Check your internet connection\n' +
                          '2. Use one of the provided test UIDs\n' +
                          '3. Verify UIDAI sandbox is accessible');
                }
            } finally {
                retrieveBtn.innerHTML = '🔍 Retrieve User Data';
                retrieveBtn.disabled = false;
                updateStats('totalRequests');
            }
        }
        
        function drawFallbackQR(canvas, qrData) {
            const ctx = canvas.getContext('2d');
            const size = 200;
            const moduleSize = 8;
            const modules = Math.floor(size / moduleSize);
            
            // Clear canvas
            ctx.fillStyle = '#FFFFFF';
            ctx.fillRect(0, 0, size, size);
            
            // Draw a simple pattern that looks like a QR code
            ctx.fillStyle = '#000000';
            
            // Draw corner markers
            for (let corner of [[0, 0], [modules-7, 0], [0, modules-7]]) {
                const [x, y] = corner;
                // Outer square
                for (let i = 0; i < 7; i++) {
                    for (let j = 0; j < 7; j++) {
                        if (i === 0 || i === 6 || j === 0 || j === 6) {
                            ctx.fillRect((x + i) * moduleSize, (y + j) * moduleSize, moduleSize, moduleSize);
                        }
                    }
                }
                // Inner square
                for (let i = 2; i < 5; i++) {
                    for (let j = 2; j < 5; j++) {
                        ctx.fillRect((x + i) * moduleSize, (y + j) * moduleSize, moduleSize, moduleSize);
                    }
                }
            }
            
            // Draw some random-looking but consistent pattern
            const dataStr = JSON.stringify(qrData);
            let seed = 0;
            for (let i = 0; i < dataStr.length; i++) {
                seed += dataStr.charCodeAt(i);
            }
            
            for (let x = 9; x < modules - 9; x++) {
                for (let y = 9; y < modules - 9; y++) {
                    if ((x + y + seed) % 3 === 0) {
                        ctx.fillRect(x * moduleSize, y * moduleSize, moduleSize, moduleSize);
                    }
                }
            }
            
            // Add text overlay
            ctx.fillStyle = '#FF0000';
            ctx.font = 'bold 12px Arial';
            ctx.fillText('DEMO QR', size - 60, size - 10);
        }
        
        function displayUidaiUserData(userData, uid, source) {
            const userDataDisplay = document.getElementById('userDataDisplay');
            const userDataContent = document.getElementById('userDataContent');
            
            userDataDisplay.classList.remove('hidden');
            
            // Handle both UIDAI format and test data format
            const address = userData.address || {};
            
            const fields = [
                { key: 'name', label: 'Full Name', icon: 'user', value: userData.name },
                { key: 'gender', label: 'Gender', icon: 'users', value: userData.gender },
                { key: 'dob', label: 'Date of Birth', icon: 'calendar', value: userData.dob },
                { key: 'dobt', label: 'DOB Type', icon: 'info', value: userData.dobt },
                { key: 'phone', label: 'Phone', icon: 'phone', value: userData.phone },
                { key: 'email', label: 'Email', icon: 'mail', value: userData.email },
                { key: 'co', label: 'Care Of', icon: 'user-check', value: address.co },
                { key: 'house', label: 'House/Building', icon: 'home', value: address.house || userData.building },
                { key: 'street', label: 'Street', icon: 'map-pin', value: address.street || userData.street },
                { key: 'landmark', label: 'Landmark', icon: 'map', value: address.landmark || userData.landmark },
                { key: 'locality', label: 'Locality', icon: 'map', value: address.locality || userData.locality },
                { key: 'vtc', label: 'Village/Town/City', icon: 'map-pin', value: address.vtc || userData.vtc },
                { key: 'subdist', label: 'Sub District', icon: 'globe', value: address.subdist || userData.subdist },
                { key: 'district', label: 'District', icon: 'globe', value: address.dist || userData.district },
                { key: 'state', label: 'State', icon: 'globe', value: address.state || userData.state },
                { key: 'pincode', label: 'Pincode', icon: 'hash', value: address.pc || userData.pincode }
            ];
            
            userDataContent.innerHTML = fields.map(field => {
                if (!field.value) return '';
                
                return `
                    <div class="flex items-center space-x-3 p-3 bg-gray-800/50 rounded-lg">
                        <i data-lucide="${field.icon}" class="w-4 h-4 text-blue-400 flex-shrink-0"></i>
                        <div class="flex-1">
                            <div class="text-gray-400 text-xs">${field.label}</div>
                            <div class="text-white font-medium">${field.value}</div>
        </div>
                    </div>
                `;
            }).filter(html => html).join('');
            
            // Determine source colors and labels
            const sourceConfig = {
                'uidai': {
                    color: 'from-green-500/20 to-blue-500/20',
                    border: 'border-green-500/30',
                    icon: '🏛️',
                    label: 'OFFICIAL UIDAI SANDBOX',
                    status: '✅ Real UIDAI Data',
                    statusColor: 'text-green-400'
                },
                'simulation': {
                    color: 'from-yellow-500/20 to-orange-500/20',
                    border: 'border-yellow-500/30',
                    icon: '🧪',
                    label: 'SIMULATION MODE',
                    status: '⚠️ Test Data',
                    statusColor: 'text-yellow-400'
                }
            };
            
            const config = sourceConfig[source] || sourceConfig['simulation'];
            
            // Add UID display at the top with source indicator
            userDataContent.insertAdjacentHTML('afterbegin', `
                <div class="col-span-full mb-4 p-4 bg-gradient-to-r ${config.color} rounded-lg border ${config.border}">
                    <div class="flex items-center justify-between">
                    <div>
                            <div class="text-blue-400 text-sm font-medium">Aadhaar UID</div>
                            <div class="text-white text-lg font-bold">${maskUID(uid)}</div>
                    </div>
                        <div class="text-right">
                            <div class="${config.statusColor} text-sm font-medium">
                                ${config.icon} ${config.label}
                    </div>
                            <div class="${config.statusColor} font-bold">${config.status}</div>
                </div>
                    </div>
                    ${userData.retrievedAt ? `
                        <div class="mt-2 text-xs text-gray-400">
                            Retrieved: ${new Date(userData.retrievedAt).toLocaleString()}
                        </div>
                    ` : ''}
                    ${source === 'uidai' ? `
                        <div class="mt-2 text-xs text-green-400 font-medium">
                            🎯 Successfully communicated with UIDAI developer.uidai.gov.in
                        </div>
                    ` : `
                        <div class="mt-2 text-xs text-yellow-400">
                            ⚠️ UIDAI sandbox unavailable - showing realistic test data
                        </div>
                    `}
            </div>
            `);
            
            // Re-initialize icons
            lucide.createIcons();
        }

        function displayUserData(userData, uid) {
            // Legacy function - redirect to new UIDAI display function
            displayUidaiUserData(userData, uid, 'simulation');
        }
        
        function startDemo() {
            currentStep = 1;
            updateStepIndicator();
            document.getElementById('step1Content').classList.remove('hidden');
            document.getElementById('step2Content').classList.add('hidden');
            document.getElementById('step3Content').classList.add('hidden');
            
            addLogEntry('DEMO_STARTED', 'New authentication demo session initiated', 'info');
        }
        
        async function generateQRCode() {
            const uid = document.getElementById('uidInput').value;
            if (uid.length !== 12) {
                alert('Please enter a valid 12-digit UID');
                return;
            }
            
            currentStep = 2;
            updateStepIndicator();
            
            document.getElementById('step1Content').classList.add('hidden');
            document.getElementById('step2Content').classList.remove('hidden');
            
            try {
                // Create session via backend API
                const sessionResponse = await fetch('/auth/session/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        uid: uid,
                        correlationId: correlationId
                    })
                });
                
                if (!sessionResponse.ok) {
                    throw new Error('Failed to create verification session');
                }
                
                const sessionData = await sessionResponse.json();
                const verificationUrl = sessionData.verificationUrl;
                
                // Store session data for polling
                sessionStorage.setItem('currentSession', JSON.stringify({
                    sessionId: sessionData.sessionId,
                    uid: uid,
                    correlationId: correlationId,
                    timestamp: new Date().toISOString(),
                    status: 'pending'
                }));
                
                const qrContainer = document.getElementById('qrCodeContainer');
                
                // Set up the container structure for single QR display
                qrContainer.innerHTML = `
                    <div class="bg-white p-6 rounded-xl shadow-lg">
                                    <div class="text-center">
                            <div class="inline-block p-4 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg">
                                <div id="qrImageContainer" class="w-48 h-48 bg-white rounded-lg p-2 flex items-center justify-content">
                                    <div style="text-align: center; width: 100%;">
                                        <div style="margin-bottom: 10px; font-weight: bold; color: #333;">📱 Scan QR Code to Verify</div>
                                        <div id="qrMainContainer" style="position: relative; display: inline-block;">
                                            <!-- Single QR display container -->
                                            <div id="qrDisplay" style="width: 200px; height: 200px; border: 2px solid #007bff; border-radius: 8px; background: #f8f9fa; display: flex; align-items: center; justify-content: center;">
                                                <div style="text-align: center; color: #666;">
                                                    <div style="font-size: 24px; margin-bottom: 8px;">⏳</div>
                                                    <div style="font-size: 12px;">Generating QR Code...</div>
                    </div>
                    </div>
                 </div>
            </div>
                                </div>
                            </div>
                            <div class="text-center mt-4">
                            <div class="bg-gray-100 rounded-lg p-3 mb-3">
                                <p class="text-sm font-mono text-gray-600">UID: ${uid}</p>
                                <p class="text-xs text-gray-500">Session: ${sessionData.sessionId.substring(0, 8)}...</p>
                                <p class="text-xs text-blue-600 mt-2">
                                    <strong>Scan with mobile device</strong><br>
                                    Complete authentication on your phone
                                </p>
        </div>
                            <div class="flex items-center justify-center space-x-2 text-orange-600">
                                <svg class="w-4 h-4 animate-spin" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"></path>
                                </svg>
                                <span class="text-sm font-medium">Waiting for mobile verification...</span>
                                </div>
        </div>
    </div>
                    </div>
                `;
                
                console.log('🚀 QR Generation starting...');
                console.log('📱 Verification URL:', verificationUrl);
                
                // Progressive QR generation - try methods one by one
                async function generateQRWithFallback() {
                    const qrDisplay = document.getElementById('qrDisplay');
                    
                    // Method 1: QR Server API
                    try {
                        const qrUrl1 = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(verificationUrl)}`;
                        
                        await new Promise((resolve, reject) => {
                            const img = new Image();
                            img.onload = () => {
                                qrDisplay.innerHTML = `<img src="${qrUrl1}" style="width: 200px; height: 200px; border-radius: 6px;" alt="QR Code">`;
                                console.log('✅ QR Method 1 (QR Server) SUCCESS');
                                resolve();
                            };
                            img.onerror = () => {
                                console.log('❌ QR Method 1 failed, trying Method 2...');
                                reject();
                            };
                            // Set timeout for this method
                            setTimeout(() => {
                                console.log('⏰ QR Method 1 timeout, trying Method 2...');
                                reject();
                            }, 3000);
                            img.src = qrUrl1;
                        });
                        return; // Success, stop here
                    } catch (error) {
                        // Continue to Method 2
                    }
                    
                    // Method 2: Google Charts API
                    try {
                        const qrUrl2 = `https://chart.googleapis.com/chart?chs=200x200&cht=qr&chl=${encodeURIComponent(verificationUrl)}`;
                        
                        await new Promise((resolve, reject) => {
                            const img = new Image();
                            img.onload = () => {
                                qrDisplay.innerHTML = `<img src="${qrUrl2}" style="width: 200px; height: 200px; border-radius: 6px;" alt="QR Code">`;
                                console.log('✅ QR Method 2 (Google Charts) SUCCESS');
                                resolve();
                            };
                            img.onerror = () => {
                                console.log('❌ QR Method 2 failed, trying Canvas...');
                                reject();
                            };
                            // Set timeout for this method
                            setTimeout(() => {
                                console.log('⏰ QR Method 2 timeout, trying Canvas...');
                                reject();
                            }, 3000);
                            img.src = qrUrl2;
                        });
                        return; // Success, stop here
                    } catch (error) {
                        // Continue to Method 3
                    }
                    
                    // Method 3: Canvas with QRious library
                    try {
                        if (typeof QRious !== 'undefined') {
                            const canvas = document.createElement('canvas');
                            canvas.width = 200;
                            canvas.height = 200;
                            canvas.style.borderRadius = '6px';
                            
                            const qr = new QRious({
                                element: canvas,
                                value: verificationUrl,
                                size: 200,
                                foreground: '#000000',
                                background: '#FFFFFF'
                            });
                            
                            qrDisplay.innerHTML = '';
                            qrDisplay.appendChild(canvas);
                            console.log('✅ QR Method 3 (Canvas) SUCCESS');
                            return; // Success, stop here
                    } else {
                            throw new Error('QRious library not available');
                    }
                    } catch (error) {
                        console.log('❌ Canvas QR failed:', error);
                    }
                    
                    // Method 4: Manual fallback
                        console.log('⚠️ All QR methods failed, showing manual link');
                    qrDisplay.innerHTML = `
                        <div style="width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 15px; background: #fff3cd; border: 2px dashed #ffc107; border-radius: 6px;">
                            <div style="font-size: 30px; margin-bottom: 10px;">📱</div>
                            <div style="font-weight: bold; color: #856404; margin-bottom: 10px;">Manual Verification</div>
                            <div style="font-size: 11px; color: #856404; word-break: break-all; line-height: 1.3;">
                                <strong>Click to open:</strong><br>
                                <a href="${verificationUrl}" target="_blank" style="color: #007bff; text-decoration: underline;">Open Verification Link</a>
                            </div>
                        </div>
                    `;
                }
                
                // Start the progressive QR generation
                generateQRWithFallback();
                
                // Add audit log
                addLogEntry('QR_GENERATED', `Cross-device verification QR generated for UID: ${uid.substring(0, 4)}****${uid.substring(8)}`, 'success');
                
                // Start polling for verification status
                startCrossDevicePolling(sessionData.sessionId);
                
            } catch (error) {
                console.error('QR Generation Error:', error);
                addLogEntry('QR_GENERATION_ERROR', `Failed to generate QR code: ${error.message}`, 'error');
                alert('Failed to generate QR code. Please try again.');
            }
        }
        
        function startCrossDevicePolling(sessionId) {
            const pollInterval = setInterval(async () => {
                try {
                    const response = await fetch(`/auth/session/${sessionId}/status`);
                const data = await response.json();

                    if (data.status === 'completed') {
                        clearInterval(pollInterval);
                        handleCrossDeviceSuccess(data);
                    } else if (data.status === 'failed') {
                        clearInterval(pollInterval);
                        handleCrossDeviceFailure(data);
                    } else if (data.status === 'expired') {
                        clearInterval(pollInterval);
                        handleCrossDeviceExpired();
                    }
                } catch (error) {
                    console.error('Polling error:', error);
                    addLogEntry('POLLING_ERROR', 'Error checking cross-device verification status', 'error');
                }
            }, 2000); // Poll every 2 seconds
            
            // Set timeout for session expiry (5 minutes)
            setTimeout(() => {
                clearInterval(pollInterval);
                handleCrossDeviceExpired();
            }, 300000);
        }

        function handleCrossDeviceSuccess(data) {
            currentStep = 3;
            updateStepIndicator();
            
            document.getElementById('step2Content').classList.add('hidden');
            document.getElementById('step3Content').classList.remove('hidden');
            
            // Update success message
            document.getElementById('step3Content').innerHTML = `
                <div class="text-center">
                    <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100 mb-4">
                        <svg class="h-8 w-8 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                    </div>
                    <h3 class="text-lg font-medium text-white mb-2">Cross-Device Verification Successful!</h3>
                    <p class="text-gray-300 mb-4">Authentication completed on mobile device</p>
                    <div class="bg-gray-700 rounded-lg p-4 mb-4">
                        <p class="text-sm text-gray-300">Verified User: <span class="text-white font-medium">${data.userData?.name || 'Verified User'}</span></p>
                        <p class="text-sm text-gray-300">Device: <span class="text-white font-medium">Mobile Device</span></p>
                        <p class="text-sm text-gray-300">Time: <span class="text-white font-medium">${new Date().toLocaleTimeString()}</span></p>
                    </div>
                    <button onclick="resetDemo()" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-lg transition-colors">
                        Start New Verification
                    </button>
                </div>
            `;
            
            addLogEntry('CROSS_DEVICE_SUCCESS', 'Cross-device verification completed successfully', 'success');
            updateStats('successCount');
        }

        function handleCrossDeviceFailure(data) {
            addLogEntry('CROSS_DEVICE_FAILED', `Cross-device verification failed: ${data.reason}`, 'error');
            alert('Cross-device verification failed. Please try again.');
        }

        function handleCrossDeviceExpired() {
            addLogEntry('CROSS_DEVICE_EXPIRED', 'Cross-device verification session expired', 'warning');
            alert('Verification session expired. Please generate a new QR code.');
        }
        
        function initiateDirectOTP() {
            const uid = document.getElementById('uidInput').value;
            if (uid.length !== 12) {
                alert('Please enter a valid 12-digit UID');
                return;
            }

            addLogEntry('OTP_INITIATED', `Direct OTP requested for UID: ${maskUID(uid)}`, 'info');
            
            // Simulate OTP request
            setTimeout(() => {
                addLogEntry('OTP_SENT', 'OTP sent to registered mobile number', 'success');
                simulateAuthentication();
            }, 1500);
            
            updateStats('totalRequests');
        }
        
        function simulateAuthentication() {
            const uid = document.getElementById('uidInput').value;
            
            addLogEntry('AUTH_STARTED', `Authentication process initiated for UID: ${maskUID(uid)}`, 'info');
            
            // Simulate authentication delay
            setTimeout(() => {
                const isSuccess = Math.random() > 0.1; // 90% success rate
                
                currentStep = 3;
                updateStepIndicator();
                
                // Hide step 2, show step 3
                document.getElementById('step2Content').classList.add('hidden');
                document.getElementById('step3Content').classList.remove('hidden');
                
                const resultContainer = document.getElementById('authResult');
                
                if (isSuccess) {
                    resultContainer.innerHTML = `
                        <div class="status-success rounded-xl p-6">
                            <div class="flex items-center space-x-3 mb-4">
                                <i data-lucide="check-circle" class="w-8 h-8"></i>
                                <h4 class="text-xl font-bold">Authentication Successful</h4>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                <div>
                                    <strong>UID:</strong> ${maskUID(uid)}
                                </div>
                                <div>
                                    <strong>Correlation ID:</strong> ${correlationId.substring(0, 12)}...
                                </div>
                                <div>
                                    <strong>Response Time:</strong> ${Math.floor(Math.random() * 500 + 200)}ms
                                </div>
                                <div>
                                    <strong>Timestamp:</strong> ${new Date().toLocaleTimeString()}
                                </div>
                            </div>
                        </div>
                    `;
                    addLogEntry('AUTH_SUCCESS', `Authentication successful for UID: ${maskUID(uid)}`, 'success');
                    updateStats('successCount');
                } else {
                    resultContainer.innerHTML = `
                        <div class="status-error rounded-xl p-6">
                            <div class="flex items-center space-x-3 mb-4">
                                <i data-lucide="x-circle" class="w-8 h-8"></i>
                                <h4 class="text-xl font-bold">Authentication Failed</h4>
                            </div>
                            <div class="text-sm">
                                <p class="mb-2"><strong>Error:</strong> Invalid biometric data or OTP mismatch</p>
                                <p><strong>Correlation ID:</strong> ${correlationId.substring(0, 12)}...</p>
                            </div>
                        </div>
                    `;
                    addLogEntry('AUTH_FAILED', `Authentication failed for UID: ${maskUID(uid)}`, 'error');
                }
                
                // Re-initialize icons for new content
                lucide.createIcons();
                
            }, 2000);
        }
        
        function resetDemo() {
            currentStep = 1;
            correlationId = generateCorrelationId();
            document.getElementById('correlationId').textContent = correlationId.substring(0, 8) + '...';
            
            updateStepIndicator();
            
            document.getElementById('step1Content').classList.remove('hidden');
            document.getElementById('step2Content').classList.add('hidden');
            document.getElementById('step3Content').classList.add('hidden');
            
            document.getElementById('uidInput').value = '';
            
            addLogEntry('DEMO_RESET', 'New authentication session started', 'info');
        }
        
        function updateStepIndicator() {
            for (let i = 1; i <= 3; i++) {
                const stepElement = document.getElementById(`step${i}`);
                if (i <= currentStep) {
                    stepElement.classList.remove('bg-gray-600');
                    stepElement.classList.add('bg-blue-500');
                } else {
                    stepElement.classList.remove('bg-blue-500');
                    stepElement.classList.add('bg-gray-600');
                }
            }
        }
        
        function addLogEntry(event, message, type) {
            const logContainer = document.getElementById('logContainer');
            const timestamp = new Date().toLocaleTimeString();
            
            const logEntry = document.createElement('div');
            logEntry.className = `p-3 rounded-lg text-sm ${getLogTypeClass(type)}`;
            logEntry.innerHTML = `
                <div class="flex items-center justify-between">
                    <span class="font-medium">${event}</span>
                    <span class="text-xs opacity-75">${timestamp}</span>
                </div>
                <div class="mt-1 opacity-90">${message}</div>
            `;
            
            logContainer.insertBefore(logEntry, logContainer.firstChild);
            
            // Keep only last 10 entries
            while (logContainer.children.length > 10) {
                logContainer.removeChild(logContainer.lastChild);
            }
        }
        
        function getLogTypeClass(type) {
            switch (type) {
                case 'success': return 'bg-green-500/20 border border-green-500/30 text-green-300';
                case 'error': return 'bg-red-500/20 border border-red-500/30 text-red-300';
                case 'warning': return 'bg-yellow-500/20 border border-yellow-500/30 text-yellow-300';
                default: return 'bg-blue-500/20 border border-blue-500/30 text-blue-300';
            }
        }
        
        function clearLogs() {
            document.getElementById('logContainer').innerHTML = '';
            addLogEntry('LOGS_CLEARED', 'Audit logs cleared', 'info');
        }
        
        function maskUID(uid) {
            if (uid.length !== 12) return uid;
            return 'XXXX-XXXX-' + uid.substring(8);
        }
        
        function updateStats(type) {
            stats[type]++;
            
            if (type === 'totalRequests') {
                stats.avgResponseTime = Math.floor(Math.random() * 300 + 200);
            }
            
            // Animate counter updates
            animateCounter('successCount', stats.successCount);
            animateCounter('totalRequests', stats.totalRequests);
            animateCounter('avgResponseTime', stats.avgResponseTime, 'ms');
        }
        
        function animateCounter(elementId, targetValue, suffix = '') {
            const element = document.getElementById(elementId);
            const currentValue = parseInt(element.textContent) || 0;
            const increment = Math.ceil((targetValue - currentValue) / 10);
            
            if (currentValue < targetValue) {
                element.textContent = Math.min(currentValue + increment, targetValue) + suffix;
                setTimeout(() => animateCounter(elementId, targetValue, suffix), 50);
            }
        }
        
        function startStatsAnimation() {
            // Simulate some initial activity
            setTimeout(() => updateStats('totalRequests'), 1000);
            setTimeout(() => updateStats('successCount'), 2000);
            setTimeout(() => updateStats('totalRequests'), 3000);
        }
        
        function showLogsModal() {
            alert('Detailed logs modal would open here with exportable audit trail data');
        }
        
        // QR Code Direct Test Function
        function testQRDirect() {
            console.log('🔧 Testing QR generation directly...');
            const testUrl = 'http://localhost:3002/auth/verify/test123';
            const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(testUrl)}`;
            
            addLogEntry('QR_DEBUG_TEST', `Testing QR with URL: ${testUrl}`, 'info');
            
            // Open test window
            const testWindow = window.open('', '_blank', 'width=450,height=600');
            testWindow.document.write(`
                <html>
                <head><title>QR Test</title>
                <style>body{font-family:Arial;padding:20px;text-align:center}img{border:1px solid #ccc}</style>
                </head>
                <body>
                    <h2>🔧 QR Code Direct Test</h2>
                    <p><strong>Test URL:</strong><br><code>${testUrl}</code></p>
                    <p><strong>QR Service:</strong><br><code style="font-size:10px">${qrUrl}</code></p>
                    <h3>QR Code:</h3>
                    <img src="${qrUrl}" alt="QR" style="width:200px;height:200px" 
                         onload="document.getElementById('status').innerHTML='✅ SUCCESS! QR loaded'; document.getElementById('status').style.color='green'"
                         onerror="document.getElementById('status').innerHTML='❌ FAILED! QR not loaded'; document.getElementById('status').style.color='red'">
                    <div id="status" style="margin-top:10px;font-weight:bold">Loading...</div>
                    <p><button onclick="window.close()">Close Test</button></p>
                </body>
                </html>
            `);
            testWindow.document.close();
        }
        
        // Theme toggle functionality
        document.getElementById('themeToggle').addEventListener('click', function() {
            // Theme toggle implementation would go here
            console.log('Theme toggle clicked');
        });
        
        // Add some demo data on load
        setTimeout(() => {
            addLogEntry('SYSTEM_READY', 'All services initialized and ready for testing', 'success');
        }, 500);
        
        setTimeout(() => {
            addLogEntry('UIDAI_CONNECTED', 'Successfully connected to UIDAI sandbox environment', 'success');
        }, 1000);
    </script>
</body>
</html>